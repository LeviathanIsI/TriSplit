<UserControl x:Class="TriSplit.Desktop.Views.Tabs.ProfilesView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:behaviors="clr-namespace:TriSplit.Desktop.Behaviors"
             AllowDrop="True"
             PreviewDragOver="ProfilesView_OnPreviewDragOver"
             Drop="ProfilesView_OnDrop"
             mc:Ignorable="d"
             d:DesignHeight="800" d:DesignWidth="1400"
             Background="{StaticResource BackgroundBrush}">


  <UserControl.Resources>
    <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
  </UserControl.Resources>

  <Grid Margin="20">
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="*"/>
      <RowDefinition Height="Auto"/>
    </Grid.RowDefinitions>

    <!-- Header Section -->
    <Grid Grid.Row="0" Margin="0,0,0,20">
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="*"/>
        <ColumnDefinition Width="Auto"/>
      </Grid.ColumnDefinitions>

      <StackPanel Grid.Column="0">
        <TextBlock Text="Data Profile Configuration"
                   Style="{StaticResource HeaderTextBlock}"
                   Foreground="{StaticResource AccentBrush}"/>
        <TextBlock Text="Map source data fields to HubSpot properties"
                   Foreground="{StaticResource SecondaryTextBrush}"
                   FontSize="14"/>
      </StackPanel>

      <StackPanel Grid.Column="1" Orientation="Vertical" VerticalAlignment="Center">
        <TextBlock Text="{Binding AutosaveStatus}"
                   Foreground="{StaticResource AccentBrush}"
                   FontStyle="Italic"
                   Margin="0,0,10,0"
                   Visibility="{Binding HasAutosaveStatus, Converter={StaticResource BoolToVisibilityConverter}}"
                   VerticalAlignment="Center"/>
        <Grid Margin="0,5,0,0">
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
          </Grid.RowDefinitions>
          <Grid.ColumnDefinitions>
            <ColumnDefinition Width="250"/>
            <ColumnDefinition Width="180"/>
            <ColumnDefinition Width="200"/>
            <ColumnDefinition Width="200"/>
            <ColumnDefinition Width="160"/>
            <ColumnDefinition Width="200"/>
            <ColumnDefinition Width="Auto"/>
          </Grid.ColumnDefinitions>

          <TextBlock Grid.Row="0" Grid.Column="0" Text="Profile Name" Foreground="{StaticResource SecondaryTextBrush}" Margin="0,0,10,2"/>
          <TextBlock Grid.Row="0" Grid.Column="1" Text="Default Association" Foreground="{StaticResource SecondaryTextBrush}" Margin="0,0,10,2"/>
          <TextBlock Grid.Row="0" Grid.Column="2" Text="Contact/Property Data Source" Foreground="{StaticResource SecondaryTextBrush}" Margin="0,0,10,2"/>
          <TextBlock Grid.Row="0" Grid.Column="3" Text="Phone Number Data Source" Foreground="{StaticResource SecondaryTextBrush}" Margin="0,0,10,2"/>
          <TextBlock Grid.Row="0" Grid.Column="4" Text="Data Type" Foreground="{StaticResource SecondaryTextBrush}" Margin="0,0,10,2"/>
          <TextBlock Grid.Row="0" Grid.Column="5" Text="Tag Note" Foreground="{StaticResource SecondaryTextBrush}" Margin="0,0,10,2"/>
          <TextBlock Grid.Row="0" Grid.Column="6" Text="Actions" Foreground="{StaticResource SecondaryTextBrush}" Margin="0,0,0,2"/>

          <TextBox Grid.Row="1" Grid.Column="0"
                   Width="250"
                   Text="{Binding ProfileName}"
                   Margin="0,0,10,0"
                   Padding="10,4"
                   VerticalAlignment="Center"
                   VerticalContentAlignment="Center"/>
          <ComboBox Grid.Row="1" Grid.Column="1"
                    Width="180"
                    ItemsSource="{Binding DefaultAssociationOptions}"
                    SelectedItem="{Binding DefaultAssociationLabel}"
                    Margin="0,0,10,0"
                    Padding="10,4"
                    VerticalAlignment="Center"
                    ToolTip="Mappings with no Association Label selected inherit this default."/>
          <TextBox Grid.Row="1" Grid.Column="2"
                   Width="200"
                   Text="{Binding ContactPropertyDataSource}"
                   Margin="0,0,10,0"
                   Padding="10,4"
                   VerticalAlignment="Center"
                   VerticalContentAlignment="Center"/>
          <TextBox Grid.Row="1" Grid.Column="3"
                   Width="200"
                   Text="{Binding PhoneDataSource}"
                   Margin="0,0,10,0"
                   Padding="10,4"
                   VerticalAlignment="Center"
                   VerticalContentAlignment="Center"/>
          <TextBox Grid.Row="1" Grid.Column="4"
                   Width="160"
                   Text="{Binding DataType}"
                   Margin="0,0,10,0"
                   Padding="10,4"
                   VerticalAlignment="Center"
                   VerticalContentAlignment="Center"/>
          <TextBox Grid.Row="1" Grid.Column="5"
                   Width="200"
                   Text="{Binding TagNote}"
                   Margin="0,0,10,0"
                   Padding="10,4"
                   VerticalAlignment="Center"
                   VerticalContentAlignment="Center"/>
          <StackPanel Grid.Row="1" Grid.Column="6" Orientation="Horizontal" VerticalAlignment="Center">
            <Button Content="Save"
                    Command="{Binding SaveProfileCommand}"
                    Style="{StaticResource PrimaryButton}"
                    Margin="0,0,10,0"
                    Padding="15,8"/>
            <Button Content="Save As"
                    Command="{Binding SaveProfileAsCommand}"
                    Style="{StaticResource SecondaryButton}"
                    Margin="0,0,10,0"
                    Padding="15,8"/>
            <Button Content="Load"
                    Command="{Binding LoadProfileCommand}"
                    Style="{StaticResource SecondaryButton}"
                    Padding="15,8"
                    Margin="0,0,10,0"/>
            <Button Content="Suggest Headers"
                    Command="{Binding LoadHeaderSuggestionsCommand}"
                    Style="{StaticResource SecondaryButton}"
                    Padding="15,8"/>
          </StackPanel>
        </Grid>
      </StackPanel>
    </Grid>

    <!-- Main Content Area -->
    <Grid Grid.Row="1">
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="250"/>
        <ColumnDefinition Width="*"/>
      </Grid.ColumnDefinitions>

      <!-- Left Panel - Saved Profiles -->
      <Border Grid.Column="0"
              Background="{StaticResource SurfaceBrush}"
              BorderBrush="{StaticResource BorderBrush}"
              BorderThickness="1"
              CornerRadius="4"
              Margin="0,0,15,0">
        <Grid>
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
          </Grid.RowDefinitions>

          <Border Grid.Row="0"
                  Background="{StaticResource SelectedBrush}"
                  BorderBrush="{StaticResource BorderBrush}"
                  BorderThickness="0,0,0,1"
                  CornerRadius="4,4,0,0">
            <TextBlock Text="SAVED DATA PROFILES"
                       Foreground="{StaticResource AccentBrush}"
                       FontWeight="SemiBold"
                       FontSize="12"
                       Margin="15,10"
                       HorizontalAlignment="Center"/>
          </Border>

          <ListBox Grid.Row="1"
                   ItemsSource="{Binding SavedProfiles}"
                   SelectedItem="{Binding SelectedProfile}"
                   Background="Transparent"
                   BorderThickness="0"
                   ScrollViewer.HorizontalScrollBarVisibility="Disabled">
            <ListBox.ItemContainerStyle>
              <Style TargetType="ListBoxItem" BasedOn="{StaticResource {x:Type ListBoxItem}}">
                <Style.Triggers>
                  <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="{StaticResource AccentBrush}"/>
                  </Trigger>
                </Style.Triggers>
              </Style>
            </ListBox.ItemContainerStyle>
            <ListBox.ItemTemplate>
              <DataTemplate>
                <Border Padding="15,10"
                        Background="Transparent">
                  <TextBlock Text="{Binding Name}"
                             VerticalAlignment="Center">
                    <TextBlock.Style>
                      <Style TargetType="TextBlock">
                        <Setter Property="Foreground" Value="{StaticResource TextBrush}"/>
                        <Style.Triggers>
                          <DataTrigger Binding="{Binding IsSelected, RelativeSource={RelativeSource AncestorType=ListBoxItem}}" Value="True">
                            <Setter Property="Foreground" Value="Black"/>
                            <Setter Property="FontWeight" Value="SemiBold"/>
                          </DataTrigger>
                        </Style.Triggers>
                      </Style>
                    </TextBlock.Style>
                  </TextBlock>
                </Border>
              </DataTemplate>
            </ListBox.ItemTemplate>
          </ListBox>

          <StackPanel Grid.Row="2"
                      Margin="10">
            <Button Content="New Data Profile"
                    Command="{Binding NewProfileCommand}"
                    Style="{StaticResource SecondaryButton}"
                    HorizontalAlignment="Stretch"
                    Margin="0,0,0,5"/>
            <Button Content="Delete Selected Data Profile"
                    Command="{Binding DeleteSelectedProfileCommand}"
                    Style="{StaticResource SecondaryButton}"
                    HorizontalAlignment="Stretch"
                    Opacity="0.7"/>
          </StackPanel>
        </Grid>
      </Border>

      <!-- Right Panel - Mapping Configuration -->
      <Border Grid.Column="1"
              Background="{StaticResource SurfaceBrush}"
              BorderBrush="{StaticResource BorderBrush}"
              BorderThickness="1"
              CornerRadius="4">
        <Grid>
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
          </Grid.RowDefinitions>

          <!-- Column Headers -->
          <Border Grid.Row="0"
                  Background="{StaticResource SelectedBrush}"
                  BorderBrush="{StaticResource BorderBrush}"
                  BorderThickness="0,0,0,1"
                  CornerRadius="4,4,0,0">
            <Grid Margin="15,12">
              <Grid.ColumnDefinitions>
                <ColumnDefinition Width="24"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="20"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="20"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="20"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="60"/>
              </Grid.ColumnDefinitions>
              <TextBlock Grid.Column="1"
                         Text="SOURCE DATA FIELD"
                         Foreground="{StaticResource AccentBrush}"
                         FontWeight="SemiBold"
                         FontSize="12"/>

              <TextBlock Grid.Column="3"
                         Text="ASSOCIATION LABEL / RELATIONSHIP"
                         Foreground="{StaticResource AccentBrush}"
                         FontWeight="SemiBold"
                         FontSize="12"/>

              <TextBlock Grid.Column="5"
                         Text="OBJECT TYPE"
                         Foreground="{StaticResource AccentBrush}"
                         FontWeight="SemiBold"
                         FontSize="12"/>

              <TextBlock Grid.Column="7"
                         Text="HUBSPOT HEADER"
                         Foreground="{StaticResource AccentBrush}"
                         FontWeight="SemiBold"
                         FontSize="12"/>

              <TextBlock Grid.Column="8"
                         Text="ACTION"
                         Foreground="{StaticResource AccentBrush}"
                         FontWeight="SemiBold"
                         FontSize="12"
                         HorizontalAlignment="Center"/>
            </Grid>
          </Border>

          <Grid Grid.Row="1">
            <!-- Selection Overlay -->
            <Border Background="#10293F"
                    BorderBrush="#FF4BA3FF"
                    BorderThickness="1"
                    CornerRadius="4"
                    Padding="14,12"
                    Margin="15,15,15,0"
                    Visibility="{Binding HasBlockSelection, Converter={StaticResource BoolToVisibilityConverter}}"
                    VerticalAlignment="Top"
                    Panel.ZIndex="1">
              <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                <TextBlock Text="{Binding BlockSelectionSummary}"
                           Foreground="{StaticResource AccentBrush}"
                           FontWeight="SemiBold"
                           VerticalAlignment="Center"
                           Margin="0,0,12,0"/>
                <Button Content="Copy Block"
                        Command="{Binding CopyBlockSelectionCommand}"
                        Style="{StaticResource PrimaryButton}"
                        Margin="0,0,8,0"/>
                <Button Content="Paste Block"
                        Command="{Binding PasteBlockSelectionCommand}"
                        IsEnabled="{Binding CanPasteBlock}"
                        Style="{StaticResource SecondaryButton}"
                        Margin="0,0,8,0"/>
                <Button Content="Clear Selection"
                        Command="{Binding ClearBlockSelectionCommand}"
                        Style="{StaticResource SecondaryButton}"/>
              </StackPanel>
            </Border>

            <!-- Mapping Rows -->
            <ScrollViewer Margin="15,15,15,0"
                          VerticalScrollBarVisibility="Auto"
                          HorizontalScrollBarVisibility="Hidden">
              <StackPanel>
                <Border Background="#12202C"
                        BorderBrush="{StaticResource AccentBrush}"
                        BorderThickness="1"
                        CornerRadius="6"
                        Padding="12"
                        Margin="15,0,15,15"
                        Visibility="{Binding HasMappingSuggestions, Converter={StaticResource BoolToVisibilityConverter}}">
                  <StackPanel>
                    <TextBlock Text="{Binding SuggestionSummary}"
                               Foreground="{StaticResource AccentBrush}"
                               FontWeight="SemiBold"
                               Margin="0,0,0,8"/>
                    <ItemsControl ItemsSource="{Binding MappingSuggestions}" Margin="0,0,0,10">
                      <ItemsControl.ItemTemplate>
                        <DataTemplate>
                          <Border Background="{StaticResource BackgroundBrush}" CornerRadius="4" Padding="8" Margin="0,0,0,6">
                            <Grid>
                              <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="2*"/>
                                <ColumnDefinition Width="2*"/>
                                <ColumnDefinition Width="Auto"/>
                              </Grid.ColumnDefinitions>
                              <CheckBox IsChecked="{Binding IsAccepted}"
                                        Content="{Binding SourceHeader}"
                                        VerticalAlignment="Center"
                                        Foreground="{StaticResource TextBrush}"
                                        FocusVisualStyle="{x:Null}"/>
                              <TextBlock Grid.Column="1"
                                         Text="{Binding SuggestedProperty, TargetNullValue=No suggested property}"
                                         VerticalAlignment="Center"
                                         Foreground="{StaticResource TextBrush}">
                                <TextBlock.Style>
                                  <Style TargetType="TextBlock">
                                    <Setter Property="Foreground" Value="{StaticResource TextBrush}"/>
                                    <Style.Triggers>
                                      <DataTrigger Binding="{Binding HasSuggestedProperty}" Value="False">
                                        <Setter Property="Foreground" Value="{StaticResource SecondaryTextBrush}"/>
                                        <Setter Property="FontStyle" Value="Italic"/>
                                      </DataTrigger>
                                    </Style.Triggers>
                                  </Style>
                                </TextBlock.Style>
                              </TextBlock>
                              <TextBlock Grid.Column="2"
                                         Text="{Binding ConfidenceDisplay}"
                                         Foreground="{StaticResource SecondaryTextBrush}"
                                         VerticalAlignment="Center"
                                         Margin="12,0,0,0"/>
                            </Grid>
                          </Border>
                        </DataTemplate>
                      </ItemsControl.ItemTemplate>
                    </ItemsControl>
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                      <Button Content="Apply Suggestions"
                              Command="{Binding ApplySuggestionsCommand}"
                              Style="{StaticResource PrimaryButton}"
                              Margin="0,0,8,0"/>
                      <Button Content="Dismiss"
                              Command="{Binding DismissSuggestionsCommand}"
                              Style="{StaticResource SecondaryButton}"/>
                    </StackPanel>
                  </StackPanel>
                </Border>

                <ItemsControl ItemsSource="{Binding FieldMappings}"
                              Margin="15">
                <ItemsControl.ItemTemplate>
                  <DataTemplate>
                  <Border Margin="0,0,0,10"
                          Background="{StaticResource BackgroundBrush}"
                          BorderBrush="{StaticResource BorderBrush}"
                          BorderThickness="1"
                          CornerRadius="4"
                          Padding="10">
                    <Border.Style>
                      <Style TargetType="Border">
                        <Setter Property="Background" Value="{StaticResource BackgroundBrush}"/>
                        <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
                        <Style.Triggers>
                          <DataTrigger Binding="{Binding IsBlockSelected}" Value="True">
                            <Setter Property="Background" Value="#1A4BA3FF"/>
                            <Setter Property="BorderBrush" Value="#FF4BA3FF"/>
                          </DataTrigger>
                        </Style.Triggers>
                      </Style>
                    </Border.Style>
                    <Grid>
                      <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="24"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="20"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="20"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="20"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="60"/>
                      </Grid.ColumnDefinitions>

                      <Border Grid.Column="0"
                              HorizontalAlignment="Center"
                              VerticalAlignment="Center"
                              behaviors:BlockSelectionBehavior.Enable="True">
                        <Border Width="12" Height="12" CornerRadius="3" Background="{StaticResource SecondaryTextBrush}">
                          <Border.Style>
                            <Style TargetType="Border">
                              <Setter Property="Background" Value="{StaticResource SecondaryTextBrush}"/>
                              <Style.Triggers>
                                <DataTrigger Binding="{Binding IsBlockSelected}" Value="True">
                                  <Setter Property="Background" Value="#FF4BA3FF"/>
                                </DataTrigger>
                              </Style.Triggers>
                            </Style>
                          </Border.Style>
                        </Border>
                      </Border>

                      <!-- Source Data Field -->
                      <TextBox Grid.Column="1"
                               Text="{Binding SourceField}"
                               VerticalAlignment="Center"
                               Margin="0">
                        <TextBox.Style>
                          <Style TargetType="TextBox" BasedOn="{StaticResource {x:Type TextBox}}">
                            <Style.Triggers>
                              <DataTrigger Binding="{Binding DataContext.IsBlockSelected, RelativeSource={RelativeSource AncestorType=Border}}" Value="True">
                                <Setter Property="BorderBrush" Value="#FF4BA3FF"/>
                                <Setter Property="BorderThickness" Value="2"/>
                              </DataTrigger>
                              <DataTrigger Binding="{Binding IsDuplicate}" Value="True">
                                <Setter Property="BorderBrush" Value="#FF4C61"/>
                                <Setter Property="BorderThickness" Value="2"/>
                              </DataTrigger>
                            </Style.Triggers>
                          </Style>
                        </TextBox.Style>
                        <TextBox.ToolTip>
                          <ToolTip Background="{StaticResource SurfaceBrush}"
                                   BorderBrush="{StaticResource AccentBrush}">
                            <StackPanel>
                              <TextBlock Text="Enter the source column name from your CSV/Excel file"
                                         Foreground="{StaticResource TextBrush}"/>
                              <TextBlock Text="Duplicate source column"
                                         Foreground="#FF4C61"
                                         Visibility="{Binding IsDuplicate, Converter={StaticResource BoolToVisibilityConverter}}"/>
                            </StackPanel>
                          </ToolTip>
                        </TextBox.ToolTip>
                      </TextBox>

                      <!-- ASSOCIATION LABEL / RELATIONSHIP -->
                      <ComboBox x:Name="AssociationCombo"
                                Grid.Column="3"
                                ItemsSource="{Binding DataContext.AssociationLabels, RelativeSource={RelativeSource AncestorType=ItemsControl}}"
                                SelectedItem="{Binding AssociationLabel}"
                                ToolTip="Leave blank to inherit the profile default association."
                                behaviors:ComboBoxDragFillBehavior.FillPropertyName="AssociationLabel"
                                VerticalAlignment="Center">
                        <ComboBox.Style>
                          <Style TargetType="ComboBox" BasedOn="{StaticResource {x:Type ComboBox}}">
                            <Style.Triggers>
                              <DataTrigger Binding="{Binding DataContext.IsBlockSelected, RelativeSource={RelativeSource AncestorType=Border}}" Value="True">
                                <Setter Property="BorderBrush" Value="#FF4BA3FF"/>
                                <Setter Property="BorderThickness" Value="2"/>
                              </DataTrigger>
                              <Trigger Property="behaviors:ComboBoxDragFillBehavior.IsDragHighlighted" Value="True">
                                <Setter Property="BorderBrush" Value="{StaticResource AccentBrush}"/>
                                <Setter Property="BorderThickness" Value="2"/>
                              </Trigger>
                            </Style.Triggers>
                          </Style>
                        </ComboBox.Style>
                      </ComboBox>

                      <Border Grid.Column="4"
                              Width="20"
                              Background="Transparent"
                              CornerRadius="2"
                              Cursor="Hand"
                              ToolTip="Click and drag to fill ASSOCIATION LABEL / RELATIONSHIP down"
                              behaviors:ComboBoxDragFillBehavior.HandleFor="{Binding ElementName=AssociationCombo}">
                        <Border.Style>
                          <Style TargetType="Border">
                            <Setter Property="Background" Value="Transparent"/>
                            <Setter Property="CornerRadius" Value="2"/>
                            <Style.Triggers>
                              <DataTrigger Binding="{Binding DataContext.IsBlockSelected, RelativeSource={RelativeSource AncestorType=Border}}" Value="True">
                                <Setter Property="BorderBrush" Value="#FF4BA3FF"/>
                                <Setter Property="BorderThickness" Value="2"/>
                              </DataTrigger>
                              <Trigger Property="behaviors:ComboBoxDragFillBehavior.IsDragHighlighted" Value="True">
                                <Setter Property="Background" Value="{StaticResource AccentBrush}"/>
                              </Trigger>
                            </Style.Triggers>
                          </Style>
                        </Border.Style>
                        <StackPanel Orientation="Vertical"
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Center">
                          <Rectangle Width="4" Height="2" Fill="{StaticResource SecondaryTextBrush}" Margin="0,1"/>
                          <Rectangle Width="4" Height="2" Fill="{StaticResource SecondaryTextBrush}" Margin="0,1"/>
                          <Rectangle Width="4" Height="2" Fill="{StaticResource SecondaryTextBrush}" Margin="0,1"/>
                        </StackPanel>
                      </Border>

                      <!-- Object Type -->
                      <ComboBox x:Name="ObjectTypeCombo"
                                Grid.Column="5"
                                ItemsSource="{Binding DataContext.ObjectTypes, RelativeSource={RelativeSource AncestorType=ItemsControl}}"
                                SelectedItem="{Binding ObjectType}"
                                behaviors:ComboBoxDragFillBehavior.FillPropertyName="ObjectType"
                                VerticalAlignment="Center">
                        <ComboBox.Style>
                          <Style TargetType="ComboBox" BasedOn="{StaticResource {x:Type ComboBox}}">
                            <Style.Triggers>
                              <DataTrigger Binding="{Binding DataContext.IsBlockSelected, RelativeSource={RelativeSource AncestorType=Border}}" Value="True">
                                <Setter Property="BorderBrush" Value="#FF4BA3FF"/>
                                <Setter Property="BorderThickness" Value="2"/>
                              </DataTrigger>
                              <Trigger Property="behaviors:ComboBoxDragFillBehavior.IsDragHighlighted" Value="True">
                                <Setter Property="BorderBrush" Value="{StaticResource AccentBrush}"/>
                                <Setter Property="BorderThickness" Value="2"/>
                              </Trigger>
                            </Style.Triggers>
                          </Style>
                        </ComboBox.Style>
                      </ComboBox>

                      <Border Grid.Column="6"
                              Width="20"
                              Background="Transparent"
                              CornerRadius="2"
                              Cursor="Hand"
                              ToolTip="Click and drag to fill Object Type down"
                              behaviors:ComboBoxDragFillBehavior.HandleFor="{Binding ElementName=ObjectTypeCombo}">
                        <Border.Style>
                          <Style TargetType="Border">
                            <Setter Property="Background" Value="Transparent"/>
                            <Setter Property="CornerRadius" Value="2"/>
                            <Style.Triggers>
                              <DataTrigger Binding="{Binding DataContext.IsBlockSelected, RelativeSource={RelativeSource AncestorType=Border}}" Value="True">
                                <Setter Property="BorderBrush" Value="#FF4BA3FF"/>
                                <Setter Property="BorderThickness" Value="2"/>
                              </DataTrigger>
                              <Trigger Property="behaviors:ComboBoxDragFillBehavior.IsDragHighlighted" Value="True">
                                <Setter Property="Background" Value="{StaticResource AccentBrush}"/>
                              </Trigger>
                            </Style.Triggers>
                          </Style>
                        </Border.Style>
                        <StackPanel Orientation="Vertical"
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Center">
                          <Rectangle Width="4" Height="2" Fill="{StaticResource SecondaryTextBrush}" Margin="0,1"/>
                          <Rectangle Width="4" Height="2" Fill="{StaticResource SecondaryTextBrush}" Margin="0,1"/>
                          <Rectangle Width="4" Height="2" Fill="{StaticResource SecondaryTextBrush}" Margin="0,1"/>
                        </StackPanel>
                      </Border>

                      <!-- HubSpot Header -->
                      <ComboBox Grid.Column="7"
                                ItemsSource="{Binding DataContext.HubSpotHeaders, RelativeSource={RelativeSource AncestorType=ItemsControl}}"
                                SelectedItem="{Binding HubSpotHeader}"
                                VerticalAlignment="Center">
                        <ComboBox.Style>
                          <Style TargetType="ComboBox" BasedOn="{StaticResource {x:Type ComboBox}}">
                            <Style.Triggers>
                              <DataTrigger Binding="{Binding DataContext.IsBlockSelected, RelativeSource={RelativeSource AncestorType=Border}}" Value="True">
                                <Setter Property="BorderBrush" Value="#FF4BA3FF"/>
                                <Setter Property="BorderThickness" Value="2"/>
                              </DataTrigger>
                            </Style.Triggers>
                          </Style>
                        </ComboBox.Style>
                      </ComboBox>

                      <!-- Remove Button -->
                      <Button Grid.Column="8"
                              Content="Remove"
                              Command="{Binding DataContext.RemoveMappingCommand, RelativeSource={RelativeSource AncestorType=ItemsControl}}"
                              CommandParameter="{Binding}"
                              Style="{StaticResource SecondaryButton}"
                              Padding="8,4"
                              FontSize="12"
                              HorizontalAlignment="Center"/>
                    </Grid>
                  </Border>
                  </DataTemplate>
                </ItemsControl.ItemTemplate>
              </ItemsControl>
              </StackPanel>
            </ScrollViewer>
        </Grid>

          <!-- Add Mapping Button -->
          <Border Grid.Row="2"
                  Background="{StaticResource SelectedBrush}"
                  BorderBrush="{StaticResource BorderBrush}"
                  BorderThickness="0,1,0,0"
                  CornerRadius="0,0,4,4">
            <Grid Margin="15,10">
              <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
              </Grid.ColumnDefinitions>

              <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                <TextBlock Text="{Binding MappingCount}"
                           Foreground="{StaticResource SecondaryTextBrush}"
                           VerticalAlignment="Center"/>
                <Border Background="#FF4C61"
                        CornerRadius="12"
                        Padding="8,2"
                        Margin="10,0,0,0"
                        Visibility="{Binding HasDuplicateMappings, Converter={StaticResource BoolToVisibilityConverter}}">
                  <TextBlock Text="{Binding DuplicateWarning}"
                             Foreground="White"
                             FontWeight="SemiBold"
                             VerticalAlignment="Center"/>
                </Border>
              </StackPanel>
              <StackPanel Grid.Column="1" Orientation="Horizontal">
                <Button Content="+ Add Mapping"
                        Command="{Binding AddMappingCommand}"
                        Style="{StaticResource PrimaryButton}"
                        Margin="0,0,10,0"/>
                <Button Content="Clear All"
                        Command="{Binding ClearMappingsCommand}"
                        Style="{StaticResource SecondaryButton}"/>
              </StackPanel>
            </Grid>
          </Border>
        </Grid>
      </Border>
    </Grid>

    <!-- Footer Actions -->
    <Border Grid.Row="2"
            Background="{StaticResource SurfaceBrush}"
            BorderBrush="{StaticResource BorderBrush}"
            BorderThickness="1"
            CornerRadius="4"
            Margin="0,15,0,0">
      <Grid Margin="15,10">
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
        </Grid.ColumnDefinitions>

        <StackPanel Grid.Column="0" Orientation="Horizontal">
          <TextBlock Text="Data Profile Status:"
                     Foreground="{StaticResource SecondaryTextBrush}"
                     VerticalAlignment="Center"
                     Margin="0,0,10,0"/>
          <TextBlock Text="{Binding ProfileStatus}"
                     Foreground="{StaticResource AccentBrush}"
                     FontWeight="Medium"
                     VerticalAlignment="Center"/>
        </StackPanel>

        <StackPanel Grid.Column="1" Orientation="Horizontal">
          <Button Content="Import CSV Headers"
                  Command="{Binding ImportHeadersCommand}"
                  Style="{StaticResource SecondaryButton}"
                  Margin="0,0,10,0"/>
          <Button Content="Export Data Profile"
                  Command="{Binding ExportProfileCommand}"
                  Style="{StaticResource SecondaryButton}"/>
        </StackPanel>
      </Grid>
    </Border>
  </Grid>
</UserControl>


