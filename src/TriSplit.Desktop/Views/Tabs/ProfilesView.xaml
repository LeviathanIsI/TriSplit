<UserControl x:Class="TriSplit.Desktop.Views.Tabs.ProfilesView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             mc:Ignorable="d"
             d:DesignHeight="800" d:DesignWidth="1400"
             Background="{StaticResource BackgroundBrush}">

  <Grid Margin="20">
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="*"/>
      <RowDefinition Height="Auto"/>
    </Grid.RowDefinitions>

    <!-- Header Section -->
    <Grid Grid.Row="0" Margin="0,0,0,20">
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="*"/>
        <ColumnDefinition Width="Auto"/>
      </Grid.ColumnDefinitions>

      <StackPanel Grid.Column="0">
        <TextBlock Text="Data Profile Configuration"
                   Style="{StaticResource HeaderTextBlock}"
                   Foreground="{StaticResource AccentBrush}"/>
        <TextBlock Text="Map source data fields to HubSpot properties"
                   Foreground="{StaticResource SecondaryTextBrush}"
                   FontSize="14"/>
      </StackPanel>

      <StackPanel Grid.Column="1" Orientation="Horizontal">
        <TextBox Width="250"
                 Text="{Binding ProfileName}"
                 VerticalAlignment="Center"
                 Margin="0,0,10,0">
          <TextBox.Resources>
            <Style TargetType="TextBox" BasedOn="{StaticResource {x:Type TextBox}}">
              <Setter Property="Tag" Value="Data Profile Name"/>
            </Style>
          </TextBox.Resources>
        </TextBox>
        <Button Content="Save Data Profile"
                Command="{Binding SaveProfileCommand}"
                Style="{StaticResource PrimaryButton}"
                Margin="0,0,10,0"
                Padding="15,8"/>
        <Button Content="Load Data Profile"
                Command="{Binding LoadProfileCommand}"
                Style="{StaticResource SecondaryButton}"
                Padding="15,8"/>
      </StackPanel>
    </Grid>

    <!-- Main Content Area -->
    <Grid Grid.Row="1">
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="250"/>
        <ColumnDefinition Width="*"/>
      </Grid.ColumnDefinitions>

      <!-- Left Panel - Saved Profiles -->
      <Border Grid.Column="0"
              Background="{StaticResource SurfaceBrush}"
              BorderBrush="{StaticResource BorderBrush}"
              BorderThickness="1"
              CornerRadius="4"
              Margin="0,0,15,0">
        <Grid>
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
          </Grid.RowDefinitions>

          <Border Grid.Row="0"
                  Background="{StaticResource SelectedBrush}"
                  BorderBrush="{StaticResource BorderBrush}"
                  BorderThickness="0,0,0,1"
                  CornerRadius="4,4,0,0">
            <TextBlock Text="SAVED DATA PROFILES"
                       Foreground="{StaticResource AccentBrush}"
                       FontWeight="SemiBold"
                       FontSize="12"
                       Margin="15,10"
                       HorizontalAlignment="Center"/>
          </Border>

          <ListBox Grid.Row="1"
                   ItemsSource="{Binding SavedProfiles}"
                   SelectedItem="{Binding SelectedProfile}"
                   Background="Transparent"
                   BorderThickness="0"
                   ScrollViewer.HorizontalScrollBarVisibility="Disabled">
            <ListBox.ItemContainerStyle>
              <Style TargetType="ListBoxItem" BasedOn="{StaticResource {x:Type ListBoxItem}}">
                <Style.Triggers>
                  <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="{StaticResource AccentBrush}"/>
                  </Trigger>
                </Style.Triggers>
              </Style>
            </ListBox.ItemContainerStyle>
            <ListBox.ItemTemplate>
              <DataTemplate>
                <Border Padding="15,10"
                        Background="Transparent">
                  <TextBlock Text="{Binding Name}"
                             VerticalAlignment="Center">
                    <TextBlock.Style>
                      <Style TargetType="TextBlock">
                        <Setter Property="Foreground" Value="{StaticResource TextBrush}"/>
                        <Style.Triggers>
                          <DataTrigger Binding="{Binding IsSelected, RelativeSource={RelativeSource AncestorType=ListBoxItem}}" Value="True">
                            <Setter Property="Foreground" Value="Black"/>
                            <Setter Property="FontWeight" Value="SemiBold"/>
                          </DataTrigger>
                        </Style.Triggers>
                      </Style>
                    </TextBlock.Style>
                  </TextBlock>
                </Border>
              </DataTemplate>
            </ListBox.ItemTemplate>
          </ListBox>

          <StackPanel Grid.Row="2"
                      Margin="10">
            <Button Content="New Data Profile"
                    Command="{Binding NewProfileCommand}"
                    Style="{StaticResource SecondaryButton}"
                    HorizontalAlignment="Stretch"
                    Margin="0,0,0,5"/>
            <Button Content="Delete Selected Data Profile"
                    Command="{Binding DeleteSelectedProfileCommand}"
                    Style="{StaticResource SecondaryButton}"
                    HorizontalAlignment="Stretch"
                    Opacity="0.7"/>
          </StackPanel>
        </Grid>
      </Border>

      <!-- Right Panel - Mapping Configuration -->
      <Border Grid.Column="1"
              Background="{StaticResource SurfaceBrush}"
              BorderBrush="{StaticResource BorderBrush}"
              BorderThickness="1"
              CornerRadius="4">
        <Grid>
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
          </Grid.RowDefinitions>

          <!-- Column Headers -->
          <Border Grid.Row="0"
                  Background="{StaticResource SelectedBrush}"
                  BorderBrush="{StaticResource BorderBrush}"
                  BorderThickness="0,0,0,1"
                  CornerRadius="4,4,0,0">
            <Grid Margin="15,12">
              <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="20"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="20"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="60"/>
              </Grid.ColumnDefinitions>

              <TextBlock Grid.Column="0"
                         Text="SOURCE DATA FIELD"
                         Foreground="{StaticResource AccentBrush}"
                         FontWeight="SemiBold"
                         FontSize="12"/>

              <TextBlock Grid.Column="2"
                         Text="ASSOCIATION LABEL"
                         Foreground="{StaticResource AccentBrush}"
                         FontWeight="SemiBold"
                         FontSize="12"/>

              <TextBlock Grid.Column="4"
                         Text="HUBSPOT HEADER"
                         Foreground="{StaticResource AccentBrush}"
                         FontWeight="SemiBold"
                         FontSize="12"/>

              <TextBlock Grid.Column="5"
                         Text="ACTION"
                         Foreground="{StaticResource AccentBrush}"
                         FontWeight="SemiBold"
                         FontSize="12"
                         HorizontalAlignment="Center"/>
            </Grid>
          </Border>

          <!-- Mapping Rows -->
          <ScrollViewer Grid.Row="1"
                        VerticalScrollBarVisibility="Auto"
                        HorizontalScrollBarVisibility="Hidden">
            <ItemsControl ItemsSource="{Binding FieldMappings}"
                          Margin="15">
              <ItemsControl.ItemTemplate>
                <DataTemplate>
                  <Border Margin="0,0,0,10"
                          Background="{StaticResource BackgroundBrush}"
                          BorderBrush="{StaticResource BorderBrush}"
                          BorderThickness="1"
                          CornerRadius="4"
                          Padding="10">
                    <Grid>
                      <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="20"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="20"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="60"/>
                      </Grid.ColumnDefinitions>

                      <!-- Source Data Field -->
                      <TextBox Grid.Column="0"
                               Text="{Binding SourceField}"
                               VerticalAlignment="Center">
                        <TextBox.ToolTip>
                          <ToolTip Background="{StaticResource SurfaceBrush}"
                                   BorderBrush="{StaticResource AccentBrush}">
                            <TextBlock Text="Enter the source column name from your CSV/Excel file"
                                       Foreground="{StaticResource TextBrush}"/>
                          </ToolTip>
                        </TextBox.ToolTip>
                      </TextBox>

                      <!-- Association Label -->
                      <ComboBox Grid.Column="2"
                                ItemsSource="{Binding DataContext.AssociationLabels, RelativeSource={RelativeSource AncestorType=ItemsControl}}"
                                SelectedItem="{Binding AssociationLabel}"
                                VerticalAlignment="Center"/>

                      <!-- HubSpot Header -->
                      <ComboBox Grid.Column="4"
                                ItemsSource="{Binding DataContext.HubSpotHeaders, RelativeSource={RelativeSource AncestorType=ItemsControl}}"
                                SelectedItem="{Binding HubSpotHeader}"
                                VerticalAlignment="Center"/>

                      <!-- Remove Button -->
                      <Button Grid.Column="5"
                              Content="Remove"
                              Command="{Binding DataContext.RemoveMappingCommand, RelativeSource={RelativeSource AncestorType=ItemsControl}}"
                              CommandParameter="{Binding}"
                              Style="{StaticResource SecondaryButton}"
                              Padding="8,4"
                              FontSize="12"
                              HorizontalAlignment="Center"/>
                    </Grid>
                  </Border>
                </DataTemplate>
              </ItemsControl.ItemTemplate>
            </ItemsControl>
          </ScrollViewer>

          <!-- Add Mapping Button -->
          <Border Grid.Row="2"
                  Background="{StaticResource SelectedBrush}"
                  BorderBrush="{StaticResource BorderBrush}"
                  BorderThickness="0,1,0,0"
                  CornerRadius="0,0,4,4">
            <Grid Margin="15,10">
              <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
              </Grid.ColumnDefinitions>

              <TextBlock Grid.Column="0"
                         Text="{Binding MappingCount}"
                         Foreground="{StaticResource SecondaryTextBrush}"
                         VerticalAlignment="Center"/>

              <StackPanel Grid.Column="1" Orientation="Horizontal">
                <Button Content="+ Add Mapping"
                        Command="{Binding AddMappingCommand}"
                        Style="{StaticResource PrimaryButton}"
                        Margin="0,0,10,0"/>
                <Button Content="Clear All"
                        Command="{Binding ClearMappingsCommand}"
                        Style="{StaticResource SecondaryButton}"/>
              </StackPanel>
            </Grid>
          </Border>
        </Grid>
      </Border>
    </Grid>

    <!-- Footer Actions -->
    <Border Grid.Row="2"
            Background="{StaticResource SurfaceBrush}"
            BorderBrush="{StaticResource BorderBrush}"
            BorderThickness="1"
            CornerRadius="4"
            Margin="0,15,0,0">
      <Grid Margin="15,10">
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="*"/>
          <ColumnDefinition Width="Auto"/>
        </Grid.ColumnDefinitions>

        <StackPanel Grid.Column="0" Orientation="Horizontal">
          <TextBlock Text="Data Profile Status:"
                     Foreground="{StaticResource SecondaryTextBrush}"
                     VerticalAlignment="Center"
                     Margin="0,0,10,0"/>
          <TextBlock Text="{Binding ProfileStatus}"
                     Foreground="{StaticResource AccentBrush}"
                     FontWeight="Medium"
                     VerticalAlignment="Center"/>
        </StackPanel>

        <StackPanel Grid.Column="1" Orientation="Horizontal">
          <Button Content="Import CSV Headers"
                  Command="{Binding ImportHeadersCommand}"
                  Style="{StaticResource SecondaryButton}"
                  Margin="0,0,10,0"/>
          <Button Content="Export Data Profile"
                  Command="{Binding ExportProfileCommand}"
                  Style="{StaticResource SecondaryButton}"
                  Margin="0,0,10,0"/>
          <Button Content="Apply Data Profile"
                  Command="{Binding ApplyProfileCommand}"
                  Style="{StaticResource PrimaryButton}"/>
        </StackPanel>
      </Grid>
    </Border>
  </Grid>
</UserControl>
