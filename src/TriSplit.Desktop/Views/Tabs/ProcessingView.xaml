<UserControl x:Class="TriSplit.Desktop.Views.Tabs.ProcessingView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             mc:Ignorable="d"
             d:DesignHeight="800" d:DesignWidth="1400"
             Background="{StaticResource BackgroundBrush}">
  <UserControl.Resources>
    <Style x:Key="TagDateCalendarDayButtonStyle" TargetType="CalendarDayButton" BasedOn="{StaticResource DarkCalendarDayButtonStyle}">
      <Setter Property="Foreground" Value="{StaticResource TextBrush}"/>
      <Setter Property="Background" Value="{StaticResource SurfaceBrush}"/>
      <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
      <Setter Property="FontWeight" Value="SemiBold"/>
      <Style.Triggers>
        <Trigger Property="IsMouseOver" Value="True">
          <Setter Property="Background" Value="{StaticResource HoverBrush}"/>
          <Setter Property="Foreground" Value="{StaticResource BackgroundBrush}"/>
        </Trigger>
        <Trigger Property="IsSelected" Value="True">
          <Setter Property="Background" Value="{StaticResource AccentBrush}"/>
          <Setter Property="Foreground" Value="{StaticResource BackgroundBrush}"/>
        </Trigger>
        <Trigger Property="IsInactive" Value="True">
          <Setter Property="Foreground" Value="{StaticResource TextBrush}"/>
          <Setter Property="Opacity" Value="0.85"/>
        </Trigger>
        <Trigger Property="IsEnabled" Value="False">
          <Setter Property="Opacity" Value="0.45"/>
        </Trigger>
      </Style.Triggers>
    </Style>
    <Style x:Key="TagDateCalendarStyle" TargetType="Calendar" BasedOn="{StaticResource DarkCalendarStyle}">
      <Setter Property="CalendarDayButtonStyle" Value="{StaticResource TagDateCalendarDayButtonStyle}"/>
      <Setter Property="Foreground" Value="{StaticResource TextBrush}"/>
      <Setter Property="Background" Value="{StaticResource SurfaceBrush}"/>
      <Setter Property="BorderBrush" Value="{StaticResource AccentBrush}"/>
      <Setter Property="BorderThickness" Value="1"/>
    </Style>
  </UserControl.Resources>

  <Grid Margin="20">
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="*"/>
      <RowDefinition Height="Auto"/>
    </Grid.RowDefinitions>

    <!-- Header Section -->
    <StackPanel Grid.Row="0" Margin="0,0,0,20">
      <TextBlock Text="Full File Processing"
                 Style="{StaticResource HeaderTextBlock}"
                 Foreground="{StaticResource AccentBrush}"/>
      <TextBlock Text="Process complete files with the selected data profile and export results"
                 Foreground="{StaticResource SecondaryTextBrush}"
                 FontSize="14"/>
    </StackPanel>

    <!-- Processing Configuration -->
    <Border Grid.Row="1"
            Background="{StaticResource SurfaceBrush}"
            BorderBrush="{StaticResource BorderBrush}"
            BorderThickness="1"
            CornerRadius="4"
            Margin="0,0,0,20">
      <Grid Margin="20">
        <Grid.RowDefinitions>
          <RowDefinition Height="Auto"/>
          <RowDefinition Height="Auto"/>
          <RowDefinition Height="Auto"/>
          <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- File Selection -->
        <Grid Grid.Row="0">
          <Grid.ColumnDefinitions>
            <ColumnDefinition Width="120"/>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="Auto"/>
          </Grid.ColumnDefinitions>

          <TextBlock Grid.Column="0"
                     Text="Input File:"
                     Foreground="{StaticResource TextBrush}"
                     VerticalAlignment="Center"/>

          <Border Grid.Column="1"
                  Background="{StaticResource BackgroundBrush}"
                  BorderBrush="{StaticResource BorderBrush}"
                  BorderThickness="1"
                  CornerRadius="4"
                  Height="36"
                  Margin="0,0,10,0">
            <TextBlock Text="{Binding InputFilePath}"
                       Foreground="{StaticResource TextBrush}"
                       VerticalAlignment="Center"
                       Margin="10,0"
                       TextTrimming="CharacterEllipsis"/>
          </Border>

          <Button Grid.Column="2"
                  Content="Select File"
                  Command="{Binding SelectFileCommand}"
                  Style="{StaticResource SecondaryButton}"
                  Width="100"/>
        </Grid>

        <!-- Profile Selection -->
        <Grid Grid.Row="1" Margin="0,15,0,0">
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
          </Grid.RowDefinitions>
          <Grid.ColumnDefinitions>
            <ColumnDefinition Width="120"/>
            <ColumnDefinition Width="300"/>
            <ColumnDefinition Width="Auto"/>
            <ColumnDefinition Width="*"/>
          </Grid.ColumnDefinitions>

          <TextBlock Grid.Column="0"
                     Text="Data Profile:"
                     Foreground="{StaticResource TextBrush}"
                     VerticalAlignment="Center"/>

          <TextBlock Grid.Column="1"
                     Text="{Binding DetectedSourceDisplay}"
                     Foreground="{StaticResource AccentBrush}"
                     VerticalAlignment="Center"
                     Margin="0,0,10,0"
                     TextTrimming="CharacterEllipsis"/>

          <TextBlock Grid.Column="2"
                     Text="Output Format:"
                     Foreground="{StaticResource TextBrush}"
                     VerticalAlignment="Center"
                     Margin="20,0,10,0"/>

          <StackPanel Grid.Column="3" Orientation="Horizontal" VerticalAlignment="Center">
            <CheckBox Content="CSV"
                         IsChecked="{Binding OutputCsv}"
                         Foreground="{StaticResource TextBrush}"
                         VerticalAlignment="Center"
                         Margin="0,0,15,0"/>
            <CheckBox Content="Excel"
                         IsChecked="{Binding OutputExcel}"
                         Foreground="{StaticResource TextBrush}"
                         VerticalAlignment="Center"
                         Margin="0,0,15,0"/>
            <CheckBox Content="JSON"
                         IsChecked="{Binding OutputJson}"
                         Foreground="{StaticResource TextBrush}"
                         VerticalAlignment="Center"/>
          </StackPanel>

          <StackPanel Grid.Row="1"
                      Grid.Column="1"
                      Orientation="Horizontal"
                      Margin="0,10,0,0"
                      Visibility="{Binding ShowSourceActions, Converter={StaticResource BoolToVisibilityConverter}}">
            <Button Content="Accept"
                    Command="{Binding AcceptDetectedSourceCommand}"
                    Style="{StaticResource PrimaryButton}"
                    Width="110"
                    Margin="0,0,12,0"/>
            <Button Content="Override"
                    Command="{Binding BeginOverrideCommand}"
                    Style="{StaticResource SecondaryButton}"
                    Width="110"/>
          </StackPanel>

          <StackPanel Grid.Row="2"
                      Grid.Column="1"
                      Grid.ColumnSpan="3"
                      Orientation="Horizontal"
                      Margin="0,10,0,0"
                      Visibility="{Binding IsOverrideMode, Converter={StaticResource BoolToVisibilityConverter}}">
            <ComboBox ItemsSource="{Binding AvailableProfiles}"
                      SelectedItem="{Binding OverrideProfile}"
                      DisplayMemberPath="Name"
                      Width="260"
                      Margin="0,0,12,0"/>
            <Button Content="Apply"
                    Command="{Binding ApplyOverrideCommand}"
                    Style="{StaticResource PrimaryButton}"
                    Width="110"
                    Margin="0,0,12,0"/>
            <Button Content="Cancel"
                    Command="{Binding CancelOverrideCommand}"
                    Style="{StaticResource SecondaryButton}"
                    Width="110"/>
          </StackPanel>

        </Grid>

        <!-- Tag Builder -->
        <Grid Grid.Row="2" Margin="0,15,0,0">
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
          </Grid.RowDefinitions>
          <Grid.ColumnDefinitions>
            <ColumnDefinition Width="120"/>
            <ColumnDefinition Width="200"/>
            <ColumnDefinition Width="150"/>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="Auto"/>
          </Grid.ColumnDefinitions>

          <TextBlock Grid.Row="0"
                     Grid.Column="0"
                     Text="Tag Date:"
                     Foreground="{StaticResource TextBrush}"
                     VerticalAlignment="Center"/>

          <DatePicker Grid.Row="0"
                      Grid.Column="1"
                      SelectedDate="{Binding TagDataDate}"
                      CalendarStyle="{StaticResource TagDateCalendarStyle}"
                      Foreground="{StaticResource TextBrush}"
                      Background="{StaticResource SurfaceBrush}"
                      BorderBrush="{StaticResource AccentBrush}"
                      BorderThickness="1"
                      Margin="0,0,10,0"
                      Height="32"/>

          <Button Grid.Row="0"
                  Grid.Column="2"
                  Content="Generate Tags"
                  Command="{Binding GenerateTagCommand}"
                  Style="{StaticResource SecondaryButton}"
                  Margin="0,0,10,0"
                  Padding="15,6"/>

          <TextBox Grid.Row="0"
                   Grid.Column="3"
                   Text="{Binding TagDraft, UpdateSourceTrigger=PropertyChanged}"
                   Margin="0,0,10,0"
                   Height="32"
                   VerticalContentAlignment="Center"/>

          <Button Grid.Row="0"
                  Grid.Column="4"
                  Content="Accept"
                  Command="{Binding AcceptTagCommand}"
                  Style="{StaticResource PrimaryButton}"
                  Padding="15,6"/>

          <StackPanel Grid.Row="1"
                      Grid.Column="1"
                      Grid.ColumnSpan="4"
                      Orientation="Vertical"
                      Margin="0,10,0,0">
            <TextBlock Text="{Binding TagStatus}"
                       Foreground="{StaticResource AccentBrush}"
                       FontStyle="Italic"
                       Margin="0,0,0,4"/>
            <TextBlock Foreground="{StaticResource SecondaryTextBrush}"
                       FontSize="12">
              <Run Text="Source:"/>
              <Run Text=" "/>
              <Run Text="  |  Type:"/>
              <Run Text=" "/>
              <Run Text="  |  Note:"/>
              <Run Text=" "/>
            </TextBlock>
          </StackPanel>
        </Grid>

      </Grid>
    </Border>

    <!-- Processing Log -->
    <Border Grid.Row="2"
            Background="{StaticResource SurfaceBrush}"
            BorderBrush="{StaticResource BorderBrush}"
            BorderThickness="1"
            CornerRadius="4">
      <Grid>
        <Grid.RowDefinitions>
          <RowDefinition Height="Auto"/>
          <RowDefinition Height="*"/>
          <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Log Header -->
        <Border Grid.Row="0"
                Background="{StaticResource SelectedBrush}"
                BorderBrush="{StaticResource BorderBrush}"
                BorderThickness="0,0,0,1"
                CornerRadius="4,4,0,0">
          <Grid Margin="15,10">
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="*"/>
              <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <TextBlock Grid.Column="0"
                       Text="PROCESSING LOG"
                       Foreground="{StaticResource AccentBrush}"
                       FontWeight="SemiBold"
                       FontSize="12"/>

            <Button Grid.Column="1"
                    Content="Clear Log"
                    Command="{Binding ClearLogCommand}"
                    Style="{StaticResource SecondaryButton}"
                    Padding="8,4"
                    FontSize="11"/>
          </Grid>
        </Border>

        <!-- Log Content -->
        <ScrollViewer Grid.Row="1"
                      VerticalScrollBarVisibility="Auto"
                      HorizontalScrollBarVisibility="Hidden">
          <ItemsControl ItemsSource="{Binding LogEntries}"
                        Margin="15,10">
            <ItemsControl.ItemTemplate>
              <DataTemplate>
                <Grid Margin="0,0,0,5">
                  <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="80"/>
                    <ColumnDefinition Width="*"/>
                  </Grid.ColumnDefinitions>

                  <TextBlock Grid.Column="0"
                             Text="{Binding Timestamp, StringFormat='HH:mm:ss'}"
                             Foreground="{StaticResource SecondaryTextBrush}"
                             FontFamily="Consolas"
                             FontSize="12"/>

                  <TextBlock Grid.Column="1"
                             Text="{Binding Message}"
                             Foreground="{Binding MessageColor}"
                             TextWrapping="Wrap"
                             FontSize="13"/>
                </Grid>
              </DataTemplate>
            </ItemsControl.ItemTemplate>
          </ItemsControl>
        </ScrollViewer>

        <!-- Progress Bar -->
        <Border Grid.Row="2"
                Background="{StaticResource SelectedBrush}"
                BorderBrush="{StaticResource BorderBrush}"
                BorderThickness="0,1,0,0"
                CornerRadius="0,0,4,4"
                Visibility="{Binding IsProcessing, Converter={StaticResource BoolToVisibilityConverter}}">
          <Grid Margin="15,10">
            <Grid.RowDefinitions>
              <RowDefinition Height="Auto"/>
              <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <ProgressBar Grid.Row="0"
                         Value="{Binding ProcessingProgress}"
                         Maximum="100"
                         Height="8"
                         Foreground="{StaticResource AccentBrush}"
                         Background="{StaticResource BackgroundBrush}"/>

            <Grid Grid.Row="1" Margin="0,5,0,0">
              <TextBlock Text="{Binding ProgressText}"
                         Foreground="{StaticResource TextBrush}"
                         HorizontalAlignment="Left"/>
              <TextBlock Text="{Binding ProcessingProgress, StringFormat='{}{0}%'}"
                         Foreground="{StaticResource AccentBrush}"
                         FontWeight="Medium"
                         HorizontalAlignment="Right"/>
            </Grid>
          </Grid>
        </Border>
      </Grid>
    </Border>

    <!-- Actions Section -->
    <Border Grid.Row="3"
            Background="{StaticResource SurfaceBrush}"
            BorderBrush="{StaticResource BorderBrush}"
            BorderThickness="1"
            CornerRadius="4"
            Margin="0,15,0,0">
      <Grid Margin="15,10">
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="*"/>
          <ColumnDefinition Width="Auto"/>
        </Grid.ColumnDefinitions>

        <StackPanel Grid.Column="0" Orientation="Horizontal">
          <TextBlock Text="Status:"
                     Foreground="{StaticResource SecondaryTextBrush}"
                     VerticalAlignment="Center"
                     Margin="0,0,10,0"/>
          <TextBlock Text="{Binding ProcessingStatus}"
                     Foreground="{Binding StatusColor}"
                     FontWeight="Medium"
                     VerticalAlignment="Center"/>
        </StackPanel>

        <StackPanel Grid.Column="1" Orientation="Horizontal">
          <Button Content="Copy Diagnostics"
                  Command="{Binding CopyDiagnosticsCommand}"
                  Style="{StaticResource SecondaryButton}"
                  Margin="0,0,10,0"/>
          <Button Content="Open Run Log"
                  Command="{Binding OpenRunLogCommand}"
                  Style="{StaticResource SecondaryButton}"
                  Margin="0,0,10,0"/>
          <Button Content="Open Output Folder"
                  Command="{Binding OpenOutputFolderCommand}"
                  Style="{StaticResource SecondaryButton}"
                  Margin="0,0,10,0"
                  IsEnabled="{Binding HasOutput}"/>
          <Button Content="Cancel"
                  Command="{Binding CancelProcessingCommand}"
                  Style="{StaticResource SecondaryButton}"
                  Margin="0,0,10,0"
                  Visibility="{Binding IsProcessing, Converter={StaticResource BoolToVisibilityConverter}}"/>
          <Button Content="Start Processing"
                  Command="{Binding StartProcessingCommand}"
                  Style="{StaticResource PrimaryButton}"
                  IsEnabled="{Binding CanStartProcessing}"/>
        </StackPanel>
      </Grid>
    </Border>
  </Grid>
</UserControl>
